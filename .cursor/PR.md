# План работ по реализации приложения Blog

## Общая информация

**Проект**: Blog Platform  
**Основа**: Laravel 12 + Inertia.js v2 + Vue 3  
**Статус**: Планирование  
**Дата создания**: 2024

## Этап 1: Подготовка базы данных и моделей

### 1.1 Создание миграции для таблицы posts
- [ ] Создать миграцию `create_posts_table.php`
- [ ] Определить структуру таблицы:
  - `id` (primary key)
  - `title` (string)
  - `slug` (string, unique)
  - `excerpt` (text, nullable)
  - `content` (longText)
  - `user_id` (foreign key)
  - `published_at` (timestamp, nullable)
  - `timestamps`
- [ ] Добавить индексы на `slug` и `published_at`
- [ ] Запустить миграцию и проверить создание таблицы

**Команда**: `php artisan make:migration create_posts_table`

### 1.2 Создание модели Post
- [ ] Создать модель `App\Models\Post`
- [ ] Настроить `$fillable` поля
- [ ] Добавить метод `casts()` для `published_at`
- [ ] Добавить связь `user()` (BelongsTo)
- [ ] Добавить scope для опубликованных статей `scopePublished()`

**Команда**: `php artisan make:model Post`

### 1.3 Обновление модели User
- [ ] Добавить связь `posts()` (HasMany) в модель User
- [ ] Проверить корректность связей

### 1.4 Создание Factory для Post
- [ ] Создать `PostFactory`
- [ ] Настроить генерацию тестовых данных:
  - `title` (faker->sentence)
  - `slug` (faker->slug)
  - `excerpt` (faker->paragraph)
  - `content` (faker->text)
  - `user_id` (User::factory)
  - `published_at` (nullable, faker->optional()->dateTime)
- [ ] Добавить state `published()` для создания опубликованных статей
- [ ] Добавить state `unpublished()` для неопубликованных статей

**Команда**: `php artisan make:factory PostFactory`

### 1.5 Создание Seeder (опционально)
- [ ] Создать `PostSeeder` для начальных данных
- [ ] Настроить создание тестовых статей

**Команда**: `php artisan make:seeder PostSeeder`

## Этап 2: Backend - Публичные маршруты и контроллеры

### 2.1 Создание публичного контроллера PostController
- [ ] Создать `App\Http\Controllers\PostController`
- [ ] Реализовать метод `index()`:
  - Получение всех опубликованных статей (где `published_at` не null)
  - Сортировка по `published_at` DESC
  - Eager loading связи `user`
  - Передача данных в Inertia компонент `Posts/Index`
- [ ] Реализовать метод `show($slug)`:
  - Поиск статьи по slug
  - Проверка существования статьи
  - Возврат 404 если статья не найдена или не опубликована
  - Eager loading связи `user`
  - Передача данных в Inertia компонент `Posts/Show`

**Команда**: `php artisan make:controller PostController`

### 2.2 Регистрация публичных маршрутов
- [ ] Добавить маршрут `GET /` в `routes/web.php`:
  - Привязать к `PostController@index`
  - Имя маршрута: `posts.index`
- [ ] Добавить маршрут `GET /{slug}` в `routes/web.php`:
  - Привязать к `PostController@show`
  - Имя маршрута: `posts.show`
  - Убедиться, что маршрут не конфликтует с другими маршрутами (должен быть последним)

## Этап 3: Backend - Административные маршруты и контроллеры

### 3.1 Создание Form Request классов
- [ ] Создать `App\Http\Requests\Admin\PostStoreRequest`:
  - Правила валидации:
    - `title`: required, string, max:255
    - `slug`: required, string, unique:posts,slug, regex для формата slug
    - `excerpt`: nullable, string
    - `content`: required, string
    - `published_at`: nullable, date
  - Кастомные сообщения об ошибках
- [ ] Создать `App\Http\Requests\Admin\PostUpdateRequest`:
  - Аналогичные правила, но `slug` уникален исключая текущую статью
  - Использовать `Rule::unique()->ignore($post->id)`

**Команда**: `php artisan make:request Admin/PostStoreRequest`  
**Команда**: `php artisan make:request Admin/PostUpdateRequest`

### 3.2 Создание административного контроллера
- [ ] Создать `App\Http\Controllers\Admin\PostController`
- [ ] Реализовать метод `index()`:
  - Получение всех статей (включая неопубликованные)
  - Сортировка по `created_at` DESC
  - Eager loading связи `user`
  - Передача данных в Inertia компонент `Admin/Posts/Index`
- [ ] Реализовать метод `create()`:
  - Отображение формы создания статьи
  - Передача данных в Inertia компонент `Admin/Posts/Create`
- [ ] Реализовать метод `store(PostStoreRequest $request)`:
  - Валидация данных через PostStoreRequest
  - Автоматическая генерация slug из title (если не указан)
  - Создание статьи с привязкой к текущему пользователю
  - Редирект на список статей с сообщением об успехе
- [ ] Реализовать метод `edit(Post $post)`:
  - Проверка существования статьи
  - Передача данных статьи в Inertia компонент `Admin/Posts/Edit`
- [ ] Реализовать метод `update(PostUpdateRequest $request, Post $post)`:
  - Валидация данных через PostUpdateRequest
  - Обновление slug (если изменился title)
  - Сохранение изменений
  - Редирект на список статей с сообщением об успехе
- [ ] Реализовать метод `destroy(Post $post)`:
  - Удаление статьи
  - Редирект на список статей с сообщением об успехе

**Команда**: `php artisan make:controller Admin/PostController --resource`

### 3.3 Регистрация административных маршрутов
- [ ] Создать файл `routes/admin.php` или добавить в `routes/web.php`
- [ ] Добавить маршруты с префиксом `/adm`:
  - `GET /adm` → `Admin\PostController@index` (имя: `admin.posts.index`)
  - `GET /adm/posts/create` → `Admin\PostController@create` (имя: `admin.posts.create`)
  - `POST /adm/posts` → `Admin\PostController@store` (имя: `admin.posts.store`)
  - `GET /adm/posts/{post}/edit` → `Admin\PostController@edit` (имя: `admin.posts.edit`)
  - `PUT/PATCH /adm/posts/{post}` → `Admin\PostController@update` (имя: `admin.posts.update`)
  - `DELETE /adm/posts/{post}` → `Admin\PostController@destroy` (имя: `admin.posts.destroy`)
- [ ] Применить middleware `auth` и `verified` ко всем административным маршрутам
- [ ] Использовать Route Model Binding для `{post}`

## Этап 4: Frontend - Публичные компоненты

### 4.1 Создание компонента списка статей (Index.vue)
- [ ] Создать `resources/js/pages/Posts/Index.vue`
- [ ] Определить props:
  - `posts`: массив статей
- [ ] Реализовать структуру:
  - Заголовок страницы
  - Список статей с карточками:
    - Заголовок статьи
    - Краткое описание (excerpt)
    - Дата публикации
    - Ссылка на полную версию через Wayfinder
  - Использовать Tailwind CSS для стилизации
  - Поддержка dark mode
- [ ] Добавить пустое состояние (если статей нет)
- [ ] Использовать компонент `<Link>` из Inertia для навигации

### 4.2 Создание компонента просмотра статьи (Show.vue)
- [ ] Создать `resources/js/pages/Posts/Show.vue`
- [ ] Определить props:
  - `post`: объект статьи
- [ ] Реализовать структуру:
  - Заголовок статьи
  - Метаинформация (дата публикации, автор)
  - Полное содержание статьи
  - Кнопка "Назад к списку"
- [ ] Использовать Tailwind CSS для стилизации
  - Поддержка dark mode
  - Типографика для чтения длинных текстов
- [ ] Обработка случая, когда статья не найдена (404)

### 4.3 Генерация Wayfinder типов
- [ ] Запустить `php artisan wayfinder:generate`
- [ ] Проверить создание типов для маршрутов:
  - `@/actions/App/Http/Controllers/PostController`
  - `@/actions/App/Http/Controllers/Admin/PostController`

## Этап 5: Frontend - Административные компоненты

### 5.1 Создание компонента списка статей в админке (Index.vue)
- [ ] Создать `resources/js/pages/Admin/Posts/Index.vue`
- [ ] Определить props:
  - `posts`: массив всех статей
- [ ] Реализовать структуру:
  - Заголовок страницы
  - Кнопка "Создать статью"
  - Таблица со списком статей:
    - Заголовок
    - Slug
    - Статус публикации
    - Дата создания/публикации
    - Автор
    - Действия (редактировать, удалить)
  - Использовать существующие UI компоненты из проекта
- [ ] Реализовать удаление статьи с подтверждением
- [ ] Использовать `<Form>` компонент из Inertia для удаления

### 5.2 Создание компонента создания статьи (Create.vue)
- [ ] Создать `resources/js/pages/Admin/Posts/Create.vue`
- [ ] Реализовать форму с полями:
  - `title` (обязательное, текстовое поле)
  - `slug` (обязательное, текстовое поле, автогенерация из title)
  - `excerpt` (опциональное, textarea)
  - `content` (обязательное, textarea или rich text editor)
  - `published_at` (опциональное, date picker)
- [ ] Использовать компонент `<Form>` из Inertia.js
- [ ] Добавить валидацию на фронтенде
- [ ] Отображение ошибок валидации
- [ ] Кнопка "Сохранить" с индикатором загрузки
- [ ] Кнопка "Отмена" (возврат к списку)
- [ ] Автогенерация slug при вводе title (через watch)

### 5.3 Создание компонента редактирования статьи (Edit.vue)
- [ ] Создать `resources/js/pages/Admin/Posts/Edit.vue`
- [ ] Определить props:
  - `post`: объект статьи для редактирования
- [ ] Реализовать форму аналогичную Create.vue
- [ ] Предзаполнить поля данными статьи
- [ ] Использовать метод PUT/PATCH для обновления
- [ ] Обработка ошибок валидации
- [ ] Кнопка "Обновить" с индикатором загрузки
- [ ] Кнопка "Отмена"

### 5.4 Использование Layout для админки
- [ ] Проверить существующий `AppLayout` или `AppSidebarLayout`
- [ ] Использовать его для административных страниц
- [ ] Добавить навигацию в админку (если необходимо)

## Этап 6: Дополнительная функциональность

### 6.1 Автоматическая генерация slug
- [ ] Создать helper метод или trait для генерации slug
- [ ] Реализовать логику:
  - Генерация из title если slug не указан
  - Проверка уникальности slug
  - Добавление суффикса если slug уже существует (например, `-2`, `-3`)
- [ ] Интегрировать в PostStoreRequest и PostUpdateRequest
- [ ] Добавить JavaScript функцию для автогенерации на фронтенде

### 6.2 Обработка ошибок
- [ ] Настроить обработку 404 для несуществующих статей
- [ ] Настроить обработку 403 для неавторизованных пользователей
- [ ] Добавить flash сообщения для успешных операций
- [ ] Использовать существующий компонент AlertError для ошибок

## Этап 7: Тестирование

### 7.1 Feature тесты для публичных маршрутов
- [ ] Создать `tests/Feature/PostTest.php`
- [ ] Тест `it('displays list of published posts')`:
  - Создать опубликованные и неопубликованные статьи
  - Проверить, что на главной странице отображаются только опубликованные
  - Проверить структуру данных через assertInertia
- [ ] Тест `it('displays single post by slug')`:
  - Создать опубликованную статью
  - Проверить отображение полной версии статьи
  - Проверить структуру данных
- [ ] Тест `it('returns 404 for non-existent post')`:
  - Проверить 404 для несуществующего slug
- [ ] Тест `it('returns 404 for unpublished post')`:
  - Проверить 404 для неопубликованной статьи

**Команда**: `php artisan make:test PostTest --pest`

### 7.2 Feature тесты для административных маршрутов
- [ ] Создать `tests/Feature/Admin/PostTest.php`
- [ ] Тест `it('displays list of all posts for authenticated user')`:
  - Авторизовать пользователя
  - Создать статьи
  - Проверить отображение всех статей в админке
- [ ] Тест `it('allows authenticated user to create post')`:
  - Авторизовать пользователя
  - Отправить POST запрос с валидными данными
  - Проверить создание статьи в БД
  - Проверить редирект
- [ ] Тест `it('validates post creation data')`:
  - Проверить валидацию обязательных полей
  - Проверить валидацию уникальности slug
- [ ] Тест `it('allows authenticated user to update post')`:
  - Создать статью
  - Отправить PUT запрос с обновленными данными
  - Проверить обновление в БД
- [ ] Тест `it('allows authenticated user to delete post')`:
  - Создать статью
  - Отправить DELETE запрос
  - Проверить удаление из БД
- [ ] Тест `it('redirects unauthenticated user to login')`:
  - Проверить редирект для неавторизованных пользователей

**Команда**: `php artisan make:test Admin/PostTest --pest`

### 7.3 Unit тесты для модели Post
- [ ] Создать `tests/Unit/PostTest.php`
- [ ] Тест связей:
  - Проверить связь `user()`
- [ ] Тест scopes:
  - Проверить scope `published()`
- [ ] Тест casts:
  - Проверить cast для `published_at`

**Команда**: `php artisan make:test PostTest --unit --pest`

### 7.4 Запуск тестов
- [ ] Запустить все тесты: `php artisan test`
- [ ] Исправить найденные ошибки
- [ ] Добиться 100% покрытия функциональности

## Этап 8: Финальная проверка и оптимизация

### 8.1 Проверка функциональности
- [ ] Проверить создание статьи через админку
- [ ] Проверить редактирование статьи
- [ ] Проверить удаление статьи
- [ ] Проверить отображение списка статей на главной
- [ ] Проверить отображение полной версии статьи
- [ ] Проверить работу slug-based routing
- [ ] Проверить автогенерацию slug
- [ ] Проверить валидацию форм

### 8.2 Проверка UI/UX
- [ ] Проверить адаптивность на мобильных устройствах
- [ ] Проверить работу dark mode
- [ ] Проверить доступность (accessibility)
- [ ] Проверить производительность загрузки страниц

### 8.3 Форматирование кода
- [ ] Запустить Laravel Pint: `vendor/bin/pint --dirty`
- [ ] Проверить форматирование фронтенда: `npm run format:check`
- [ ] Исправить найденные проблемы форматирования

### 8.4 Проверка безопасности
- [ ] Проверить защиту от CSRF
- [ ] Проверить авторизацию административных маршрутов
- [ ] Проверить валидацию всех входных данных
- [ ] Проверить защиту от SQL injection (использование Eloquent)

### 8.5 Документация
- [ ] Обновить README.md с инструкциями по установке
- [ ] Добавить комментарии в код где необходимо
- [ ] Проверить соответствие документации ARC.md реализованному функционалу

## Этап 9: Деплой и мониторинг (опционально)

### 9.1 Подготовка к продакшену
- [ ] Настроить переменные окружения для продакшена
- [ ] Настроить оптимизацию ассетов (production build)
- [ ] Настроить кэширование конфигурации и маршрутов
- [ ] Проверить работу на продакшен-окружении

### 9.2 Мониторинг
- [ ] Настроить логирование ошибок
- [ ] Настроить мониторинг производительности (опционально)

## Чеклист готовности

Перед завершением проекта убедиться:

- [ ] Все миграции выполнены успешно
- [ ] Все модели созданы и работают корректно
- [ ] Все контроллеры реализованы
- [ ] Все маршруты зарегистрированы и работают
- [ ] Все Form Request классы созданы с правильной валидацией
- [ ] Все Vue компоненты созданы и работают
- [ ] Wayfinder типы сгенерированы
- [ ] Все тесты написаны и проходят
- [ ] Код отформатирован через Pint
- [ ] Фронтенд отформатирован через Prettier
- [ ] Документация обновлена
- [ ] Приложение работает локально без ошибок

## Приоритеты выполнения

1. **Высокий приоритет**: Этапы 1-3 (Backend основа)
2. **Высокий приоритет**: Этап 4 (Публичные страницы)
3. **Средний приоритет**: Этап 5 (Административные страницы)
4. **Средний приоритет**: Этап 6 (Дополнительная функциональность)
5. **Высокий приоритет**: Этап 7 (Тестирование)
6. **Средний приоритет**: Этап 8 (Финальная проверка)

## Оценка времени

- **Этап 1**: 2-3 часа
- **Этап 2**: 1-2 часа
- **Этап 3**: 3-4 часа
- **Этап 4**: 3-4 часа
- **Этап 5**: 4-5 часов
- **Этап 6**: 1-2 часа
- **Этап 7**: 3-4 часа
- **Этап 8**: 2-3 часа

**Общая оценка**: 19-27 часов работы

## Заметки

- При создании компонентов использовать существующие UI компоненты из `resources/js/components/ui/`
- Следовать существующим паттернам именования и структуры проекта
- Использовать TypeScript для типизации на фронтенде
- Все формы должны использовать компонент `<Form>` из Inertia.js v2
- При работе с датами использовать форматирование через Laravel или Vue composables

